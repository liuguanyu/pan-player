# åº¦ç›˜æ’­æ”¾å™¨ (DuPan Player)

åŸºäºç™¾åº¦ç½‘ç›˜çš„éŸ³ä¹æ’­æ”¾å™¨ï¼Œä½¿ç”¨ Electron + React 19 + Vite æ„å»ºçš„è·¨å¹³å°æ¡Œé¢åº”ç”¨ã€‚

## æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**: React 19
- **æ¡Œé¢æ¡†æ¶**: Electron
- **æ„å»ºå·¥å…·**: Vite
- **çŠ¶æ€ç®¡ç†**: Zustand (with persistence)
- **æ ·å¼æ–¹æ¡ˆ**: TailwindCSS + Shadcn/UI
- **æŸ¥è¯¢åº“**: @tanstack/react-query
- **è¯­è¨€**: TypeScript

## åŠŸèƒ½ç‰¹æ€§

### 1. ç”¨æˆ·è®¤è¯
- âœ… ç™¾åº¦OAuthè®¾å¤‡ç æˆæƒæµç¨‹
- âœ… è‡ªåŠ¨ä»¤ç‰Œåˆ·æ–°
- âœ… æœ¬åœ°æŒä¹…åŒ–å­˜å‚¨
- âœ… ç™»å½•çŠ¶æ€ç®¡ç†

### 2. æ’­æ”¾æ§åˆ¶
- âœ… æ’­æ”¾/æš‚åœ/ä¸Šä¸€æ›²/ä¸‹ä¸€æ›²
- âœ… è¿›åº¦æ¡æ‹–æ‹½
- âœ… éŸ³é‡æ§åˆ¶ä¸é™éŸ³åŠŸèƒ½
- âœ… æ’­æ”¾æ¨¡å¼åˆ‡æ¢ï¼ˆé¡ºåº/éšæœº/å•æ›²å¾ªç¯ï¼‰
- âœ… æ­Œæ›²åæ»šåŠ¨æ˜¾ç¤ºï¼ˆé•¿æ–‡ä»¶åï¼‰
- âœ… å€é€Ÿæ’­æ”¾ï¼ˆ0.5x ~ 2.0xï¼‰

### 3. æ’­æ”¾åˆ—è¡¨ç®¡ç†
- âœ… åˆ›å»º/åˆ é™¤æ’­æ”¾åˆ—è¡¨
- âœ… ä»ç™¾åº¦ç½‘ç›˜æµè§ˆå¹¶é€‰æ‹©éŸ³é¢‘æ–‡ä»¶
- âœ… æ”¯æŒé€’å½’æ·»åŠ æ–‡ä»¶å¤¹
- âœ… æœ¬åœ°å­˜å‚¨æ’­æ”¾åˆ—è¡¨
- âœ… æœ€è¿‘æ’­æ”¾åˆ—è¡¨ï¼ˆæœ€å¤š30é¦–ï¼‰
- âœ… æ”¯æŒçš„éŸ³é¢‘æ ¼å¼ï¼šmp3, m4a, flac, wav, ogg, aac, wma
- âœ… æ”¯æŒæ— æŸæ ¼å¼è½¬ç æ’­æ”¾ï¼šALAC (.m4a), APE (.ape) - å®æ—¶è½¬ç ä¸ºWAV

### 4. æ­Œè¯æ˜¾ç¤º
- âœ… LRCæ­Œè¯è§£æ
- âœ… åŒæ­¥æ­Œè¯æ»šåŠ¨
- âœ… æ‰‹åŠ¨é€‰æ‹©LRCæ–‡ä»¶
- âœ… è‡ªåŠ¨å…³è”åŒæ–‡ä»¶å¤¹.lrcæ–‡ä»¶
- âœ… LRCæ­Œè¯ç¼–è¾‘å™¨ï¼ˆæ—¶é—´è½´æ ‡æ³¨ã€å¯¼å…¥/å¯¼å‡ºï¼‰

### 5. éŸ³é¢‘å¯è§†åŒ–
- âœ… ç²’å­æ•ˆæœå¯è§†åŒ–
- âœ… æŸ±çŠ¶å›¾å¯è§†åŒ–
- âœ… æ³¢å½¢å›¾å¯è§†åŒ–
- âœ… è·³èˆå°ç¾Šç‰¹æ•ˆ

### 6. ç³»ç»Ÿé›†æˆ
- âœ… ç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡ä¸èœå•
  - æ˜¾ç¤ºå½“å‰æ’­æ”¾æ­Œæ›²ï¼ˆé•¿æ­Œæ›²åè·‘é©¬ç¯æ»šåŠ¨ï¼‰
  - é™éŸ³/å–æ¶ˆé™éŸ³æ§åˆ¶
  - æ’­æ”¾æ§åˆ¶ï¼ˆä¸Šä¸€æ›²/æ’­æ”¾æš‚åœ/ä¸‹ä¸€æ›²ï¼‰
- âœ… è¿·ä½ æ’­æ”¾å™¨æ¨¡å¼ï¼ˆæ‚¬æµ®çª—å£ï¼‰
- âœ… å…¨å±€å¿«æ·é”®æ”¯æŒ
- âœ… åª’ä½“é”®æ”¯æŒï¼ˆä¸Šä¸€æ›²/ä¸‹ä¸€æ›²/æ’­æ”¾æš‚åœï¼‰
- âœ… è·¨å¹³å°æ—¥å¿—ç³»ç»Ÿï¼ˆWindowsä¸­æ–‡æ˜¾ç¤ºä¼˜åŒ–ï¼‰

### 7. ç”¨æˆ·ç•Œé¢
- âœ… ç°ä»£åŒ–Material Designé£æ ¼
- âœ… å“åº”å¼å¸ƒå±€
- âœ… æš—è‰²ä¸»é¢˜æ”¯æŒ
- âœ… ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºä¸é€€å‡ºç™»å½•
- âœ… æ­Œæ›²åˆ—è¡¨æœç´¢åŠŸèƒ½
- âœ… ç™»å½•çŠ¶æ€è‡ªåŠ¨æ£€æµ‹ï¼ˆå·²ç™»å½•è·³è¿‡æˆæƒæµç¨‹ï¼‰

## å¿«æ·é”®è¯´æ˜

æ”¯æŒä¸¤ç§å¿«æ·é”®æ“ä½œæ–¹å¼ï¼Œå³ä½¿åº”ç”¨åœ¨åå°è¿è¡Œä¹Ÿèƒ½æ§åˆ¶ï¼š

| åŠŸèƒ½ | å¤šåª’ä½“é”®ç›˜ | æ™®é€šé”®ç›˜ (ç»„åˆé”®) |
|---|---|---|
| ä¸Šä¸€æ›² | `â®` MediaPrev | `Ctrl + Alt + â†` |
| ä¸‹ä¸€æ›² | `â­` MediaNext | `Ctrl + Alt + â†’` |
| æ’­æ”¾/æš‚åœ | `â¯` MediaPlayPause | `Ctrl + Alt + Space` |
| é™éŸ³/æ¢å¤ | `ğŸ”‡` VolumeMute | - |
| éŸ³é‡å¢åŠ  | `ğŸ”Š` VolumeUp | `Ctrl + Alt + â†‘` |
| éŸ³é‡å‡å°‘ | `ğŸ”‰` VolumeDown | `Ctrl + Alt + â†“` |
| åˆ‡æ¢æ’­æ”¾æ¨¡å¼ | - | `Ctrl + Shift + M` |

*æ³¨ï¼šMacç³»ç»Ÿä¸Š `Ctrl` å¯¹åº” `Command` é”®*

## é¡¹ç›®ç»“æ„

```
dupan-player/
â”œâ”€â”€ electron/                      # Electronä¸»è¿›ç¨‹
â”‚   â”œâ”€â”€ main.ts                   # ä¸»è¿›ç¨‹å…¥å£
â”‚   â”œâ”€â”€ preload.ts                # é¢„åŠ è½½è„šæœ¬
â”‚   â”œâ”€â”€ logger.ts                 # è·¨å¹³å°æ—¥å¿—å·¥å…·
â”‚   â””â”€â”€ audio-stream-transcoder.ts # éŸ³é¢‘è½¬ç æœåŠ¡
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/          # Reactç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ auth/                 # è®¤è¯ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ player/               # æ’­æ”¾å™¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ PlayerControls.tsx      # æ’­æ”¾æ§åˆ¶
â”‚   â”‚   â”‚   â”œâ”€â”€ AudioVisualizer.tsx     # éŸ³é¢‘å¯è§†åŒ–
â”‚   â”‚   â”‚   â”œâ”€â”€ MiniPlayer.tsx          # è¿·ä½ æ’­æ”¾å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ BackgroundAudio.tsx     # åå°éŸ³é¢‘
â”‚   â”‚   â”‚   â””â”€â”€ visualizations/         # å¯è§†åŒ–ç‰¹æ•ˆ
â”‚   â”‚   â”œâ”€â”€ playlist/             # æ’­æ”¾åˆ—è¡¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ PlaylistSidebar.tsx     # ä¾§è¾¹æ 
â”‚   â”‚   â”‚   â”œâ”€â”€ SongList.tsx            # æ­Œæ›²åˆ—è¡¨
â”‚   â”‚   â”‚   â””â”€â”€ AddPlaylistDialog.tsx   # æ·»åŠ åˆ—è¡¨å¯¹è¯æ¡†
â”‚   â”‚   â”œâ”€â”€ lyrics/               # æ­Œè¯ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ LyricsDisplay.tsx       # æ­Œè¯æ˜¾ç¤º
â”‚   â”‚   â”‚   â””â”€â”€ LyricsEditor.tsx        # æ­Œè¯ç¼–è¾‘å™¨
â”‚   â”‚   â””â”€â”€ ui/                   # Shadcn UIç»„ä»¶
â”‚   â”œâ”€â”€ services/                 # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ auth.service.ts             # è®¤è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ baidu-api.service.ts        # ç™¾åº¦ç½‘ç›˜API
â”‚   â”‚   â”œâ”€â”€ playlist.service.ts         # æ’­æ”¾åˆ—è¡¨æœåŠ¡
â”‚   â”‚   â””â”€â”€ audio-context.service.ts    # éŸ³é¢‘ä¸Šä¸‹æ–‡
â”‚   â”œâ”€â”€ store/              # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ playerStore.ts  # Zustandæ’­æ”¾å™¨çŠ¶æ€
â”‚   â”œâ”€â”€ lib/                # å·¥å…·åº“
â”‚   â”‚   â”œâ”€â”€ http-client.ts  # HTTPå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ lrc-parser.ts   # LRCè§£æå™¨
â”‚   â”‚   â””â”€â”€ utils.ts        # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ types/              # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ hooks/              # React Hooks
â”‚   â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ App.tsx             # åº”ç”¨æ ¹ç»„ä»¶
â”‚   â””â”€â”€ main.tsx            # åº”ç”¨å…¥å£
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tsconfig.json
â””â”€â”€ tailwind.config.js
```

## å¼€å‘æŒ‡å—

### å‰ç½®è¦æ±‚

- Node.js >= 18
- npm æˆ– yarn

### å®‰è£…ä¾èµ–

```bash
npm install
```

### å¼€å‘æ¨¡å¼

```bash
npm run dev
```

è¿™å°†åŒæ—¶å¯åŠ¨ï¼š
- Viteå¼€å‘æœåŠ¡å™¨ï¼ˆç«¯å£5173ï¼‰
- Electronåº”ç”¨

### æ„å»ºåº”ç”¨

```bash
npm run build
```

### ç¯å¢ƒé…ç½®

åœ¨ `src/config/credentials.ts` ä¸­é…ç½®ç™¾åº¦åº”ç”¨å‡­æ®ï¼š

```typescript
export const BAIDU_CONFIG = {
  CLIENT_ID: 'your_client_id',
  CLIENT_SECRET: 'your_client_secret',
  SCOPE: 'basic,netdisk'
};
```

## æ ¸å¿ƒå®ç°

### 1. è®¤è¯æµç¨‹

åº”ç”¨ä½¿ç”¨ç™¾åº¦OAuth 2.0è®¾å¤‡ç æˆæƒæµç¨‹ï¼š

1. è·å–è®¾å¤‡ç å’Œç”¨æˆ·ç 
2. ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ç”¨æˆ·ç æˆæƒ
3. åº”ç”¨è½®è¯¢æˆæƒçŠ¶æ€
4. è·å–è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ
5. è‡ªåŠ¨åˆ·æ–°è¿‡æœŸä»¤ç‰Œ

**å…³é”®ä»£ç **: [`src/services/auth.service.ts`](src/services/auth.service.ts)

### 2. ç™¾åº¦ç½‘ç›˜APIé›†æˆ

é€šè¿‡Electron IPCç»•è¿‡CORSé™åˆ¶ï¼š

```typescript
// æ¸²æŸ“è¿›ç¨‹ -> ä¸»è¿›ç¨‹ -> HTTPè¯·æ±‚
const response = await window.electronAPI.httpRequest({
  method: 'GET',
  url: 'https://pan.baidu.com/rest/2.0/xpan/file',
  params: { method: 'list', dir: '/' }
});
```

**å…³é”®ä»£ç **: 
- [`electron/main.ts`](electron/main.ts)
- [`src/services/baidu-api.service.ts`](src/services/baidu-api.service.ts)

### 3. çŠ¶æ€ç®¡ç†

ä½¿ç”¨Zustandè¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Œå¹¶æŒä¹…åŒ–å…³é”®æ•°æ®ï¼š

```typescript
export const usePlayerStore = create<PlayerState>()(
  persist(
    (set, get) => ({
      // çŠ¶æ€å®šä¹‰
      playlists: [],
      recentSongs: [],
      volume: 0.7,
      playbackMode: 'order',
      // ... æ–¹æ³•å®šä¹‰
    }),
    {
      name: 'player-storage',
      partialize: (state) => ({
        volume: state.volume,
        playbackMode: state.playbackMode,
        playlists: state.playlists,
        recentSongs: state.recentSongs
      })
    }
  )
);
```

**å…³é”®ä»£ç **: [`src/store/playerStore.ts`](src/store/playerStore.ts)

### 4. LRCæ­Œè¯è§£æ

æ”¯æŒæ ‡å‡†LRCæ ¼å¼æ­Œè¯ï¼š

```
[00:12.00]ç¬¬ä¸€å¥æ­Œè¯
[00:17.20]ç¬¬äºŒå¥æ­Œè¯
[00:21.10]ç¬¬ä¸‰å¥æ­Œè¯
```

**å…³é”®ä»£ç **: [`src/lib/lrc-parser.ts`](src/lib/lrc-parser.ts)

## æ›´æ–°æ—¥å¿—

### v1.2.0 (2026-01-21)
- âœ… æ·»åŠ LRCæ­Œè¯ç¼–è¾‘å™¨
  - çº¯æ–‡æœ¬å¯¼å…¥åŠŸèƒ½
  - æ—¶é—´è½´æ ‡æ³¨ï¼ˆå¿«æ·é”®æ”¯æŒï¼‰
  - LRCæ–‡ä»¶å¯¼å‡º
- âœ… ä¼˜åŒ–ç³»ç»Ÿæ‰˜ç›˜
  - æ˜¾ç¤ºå½“å‰æ’­æ”¾æ­Œæ›²
  - é•¿æ­Œæ›²åè·‘é©¬ç¯æ»šåŠ¨æ•ˆæœ
  - é™éŸ³çŠ¶æ€åŒæ­¥æ˜¾ç¤º
- âœ… ä¿®å¤Windowsä¸­æ–‡æ˜¾ç¤ºé—®é¢˜
  - å®ç°è·¨å¹³å°æ—¥å¿—ç³»ç»Ÿ
  - GBKç¼–ç è‡ªåŠ¨è½¬æ¢
- âœ… ä¼˜åŒ–ç™»å½•æµç¨‹
  - è‡ªåŠ¨æ£€æµ‹å·²ç™»å½•çŠ¶æ€
  - è·³è¿‡ä¸å¿…è¦çš„æˆæƒæ­¥éª¤

### v1.1.0 (2026-01-20)
- âœ… æ·»åŠ éŸ³é¢‘å¯è§†åŒ–ç‰¹æ•ˆ
- âœ… æ·»åŠ å€é€Ÿæ’­æ”¾åŠŸèƒ½
- âœ… æ·»åŠ æ­Œæ›²åˆ—è¡¨æœç´¢
- âœ… æ·»åŠ è¿·ä½ æ’­æ”¾å™¨æ¨¡å¼
- âœ… æ·»åŠ å…¨å±€å¿«æ·é”®æ”¯æŒ

### v1.0.0 (2026-01-19)
- âœ… åŸºç¡€æ’­æ”¾åŠŸèƒ½
- âœ… ç™¾åº¦ç½‘ç›˜é›†æˆ
- âœ… æ’­æ”¾åˆ—è¡¨ç®¡ç†
- âœ… LRCæ­Œè¯æ˜¾ç¤º
- âœ… ç³»ç»Ÿæ‰˜ç›˜é›†æˆ

## å¾…å®ŒæˆåŠŸèƒ½

- [ ] æ’­æ”¾åˆ—è¡¨æ’åºåŠŸèƒ½
- [ ] æ’­æ”¾é˜Ÿåˆ—ç®¡ç†
- [ ] å‡è¡¡å™¨åŠŸèƒ½

## è®¸å¯è¯

MIT License

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼